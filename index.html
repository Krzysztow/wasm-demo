<!DOCTYPE html>
<!-- add.html -->
<html>
  <head></head>
  <body>
    <script type="text/javascript" src="add.js"></script>   
    <script type="module">

      var memory = undefined;

      Module.onRuntimeInitialized = () => {
        console.log('The answer is: ' + Module._add(1, 2));

        const inputBytes = new Uint8Array(10);
        inputBytes.forEach((_, i, a) => a[i] = i);

        try {
          var chosenSrcStart = Module._malloc(10);
          Module.HEAP8.set(inputBytes, chosenSrcStart);

          var chosenDstStart = Module._malloc(5);
          const printStart = chosenDstStart - 2;
          const printEnd = chosenDstStart + inputBytes.length + 2;

          console.log("dst before:", Module.HEAP8.subarray(printStart, printEnd));

          Module._unsafe_memcpy(chosenSrcStart, inputBytes.length, chosenDstStart);

          console.log("dst after:", Module.HEAP8.subarray(printStart, printEnd));
        }
        catch(e) {
          console.error("Error:", e);
        }
        finally {
          Module._free(chosenSrcStart);
          Module._free(chosenDstStart);
        }
      };
    </script>
  </body>
</html>
